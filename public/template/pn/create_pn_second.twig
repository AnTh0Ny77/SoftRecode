{% extends 'new_layout.twig' %}
{% block style %}
<link href="vendor/fontawesome/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="public/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="public/bootstrap/css/bootstrap-select.min.css">
<link rel="stylesheet" type="text/css" href="public/datatable/datatables.min.css">
<link rel="stylesheet" type="text/css" href="public/chosen/chosen.min.css">
<link rel="stylesheet" href="public/css/dashboard.css">
<link rel="stylesheet" href="public/css/stepper.css">

{% endblock %}
{% block main %}



<main role="main" class="container-fluid my-3 col-11 container-body" style="background-color:   #f3f3f3  ;">
    <input type="hidden" id="relation" value="{{model_relation}}">
    <div class="d-flex justify-content-start">
        <div class="bs-stepper col-11">
            <div class="bs-stepper-header" role="tablist">
                <div class="step" data-target="#logins-part">
                    <button type="button" class="step-trigger" role="tab" aria-controls="logins-part" id="logins-part-trigger">
                        <span class="bs-stepper-circle">1</span>
                        <span class="bs-stepper-label">Nom du Pn</span>
                    </button>
                </div>
                <div class="line"></div>
                <div class="step" data-target="#modele-part-trigger">
                    <button type="button" class="step-trigger" role="tab" aria-controls="information-part"
                        id="modele-part-trigger">
                        <span class="bs-stepper-circle">2</span>
                        <span class="bs-stepper-label">Modèles liés</span>
                    </button>
                </div>
                <div class="line"></div>
                <div class="step" data-target="#information-part">
                    <button type="button" class="step-trigger" role="tab" aria-controls="information-part"
                        id="information-part-trigger">
                        <span class="bs-stepper-circle">3</span>
                        <span class="bs-stepper-label">Informations</span>
                    </button>
                </div>
            </div>
            <div class="bs-stepper-content">
                <!-- your steps content here -->
                <div id="logins-part" class="content" role="tabpanel" aria-labelledby="logins-part-trigger"></div>
                <div id="information-part" class="content" role="tabpanel" aria-labelledby="information-part-trigger"></div>
            </div>
        </div>

    </div>
    
     <div class="container mt-5 ">
        <div class="d-flex">
            <div class="col-11">
                <h3 class="text-muted">Choix des modèles associés pour :  <b>{{pn.apn__pn_long}}</b></h3>
                <div class="alert alert-secondary mt-3 text-muted" role="alert">
                    <i class="far fa-question-circle"></i> Il est possible d'associer <b>1 ou plusieurs modèles</b> OU de  <b> poursuivre sans en associer </b> ! 
                </div>
                <form action="create-pn-third" method="POST" class="mt-3"  >
                    <input type="hidden" name="id_pn" value="{{pn.apn__pn}}" >
                    <input type="hidden" name="model_array" id="model_array">
                    <select name="select_models" data-placeholder="Choisir des modèles" multiple class="chosen-select col-12" id="select_multiple">
                        {% for modele in model_list %}
                       
                                <option value="{{modele.afmm__id}}"> {{ modele.famille ~ " " ~ modele.Marque ~   " " ~ modele.afmm__modele}}</option>
                            
                        {% endfor %}
                        
                    </select>

                    <h3 class="text-muted mt-5">Choix des caractéristiques pour :  <b>{{pn.apn__pn_long}}</b></h3>
                    <div class="alert alert-secondary mt-3 text-muted" role="alert">
                        <i class="far fa-question-circle"></i> Les champs multiples ou obligatoires son indiqués ! </b> ! 
                    </div>
                    {% for data in forms_data %}

                        {% if data.aac__option == 'UN' %}
                          <div class="form-group">
                            <label for="labelUN">{{data.aac__cle_txt}}</label>
                            <select class=" selectpicker col-12" name="{{data.aac__cle}}" >
                                    <option value="" selected> Non-renseigné</option>
                                {% for clefs in data.key_responses %}
                               
                                        <option value="{{clefs.aav__valeur}}"> {{ clefs.aav__valeur_txt}}</option>
                                    
                                {% endfor %}
                                
                            </select>
                          </div>

                        {% elseif data.aac__option == 'UN!' %}
                            <div class="form-group">
                                <label for="labelUN!">{{data.aac__cle_txt}} <small class="text-danger">Obligatoires</small></label>
                                <select class=" selectpicker  col-12" name="{{data.aac__cle}}" required>
                                    {% for clefs in data.key_responses %}
                                
                                            <option value="{{clefs.aav__valeur}}"> {{ clefs.aav__valeur_txt}}</option>
                                        
                                    {% endfor %}
                                    
                                </select>
                            </div>

                        {% elseif data.aac__option == 'XX' %}

                        <div class="form-group">
                            <label for="labelXX">{{data.aac__cle_txt}} <small class="text-success">Choix multiples</small></label>
                            <select class=" selectpicker col-12"name="{{data.aac__cle}}[]" multiple>
                                <option value="" selected> Non renseignés</option>
                                {% for clefs in data.key_responses %}
                            
                                        <option value="{{clefs.aav__valeur}}"> {{ clefs.aav__valeur_txt}}</option>
                                    
                                {% endfor %}
                                
                            </select>
                        </div>

                        {% elseif data.aac__option == 'XX!' %}
                        <div class="form-group">
                            <label for="labelXX!">{{data.aac__cle_txt}} <small class="text-success">Choix multiples</small> <small class="text-danger">Obligatoires</small></label>
                            <select class="border selectpicker col-12" name="{{data.aac__cle}}" multiple required>
                                {% for clefs in data.key_responses %}
                            
                                        <option value="{{clefs.aav__valeur}}"> {{ clefs.aav__valeur_txt}}</option>
                                    
                                {% endfor %}
                                
                            </select>
                        </div>

                        {% elseif data.aac__option == '2X' %}
                            
                        {% endif %}
                        
                    {% endfor %}
                    <div class="modal-footer">
                        <button class="btn btn-primary">Valider</button>
                       
                    </div>
                </form>
            </div>
         

        </div>
      
       
        
     </div>
</main>


{% endblock %}
{% block script %}
<!-- jQuery first, then Bootstrap JS -->
<script type="text/javascript" src="public/datatable/datatables.min.js"></script>
<script type="text/javascript" src="public/bootstrap/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="public/bootstrap/js/bootstrap-select.min.js"></script>
<script type="text/javascript" src="public/chosen/chosen.jquery.min.js"></script>
<script type="text/javascript" src="public/js/stepper.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
            var stepper = new Stepper($('.bs-stepper')[0])
            stepper.next()
            $(".chosen-select").chosen({max_selected_options: 5});
        })

        $(".chosen-select").on('change' , function()
        {
            let select = [] ; 
            for(var option of document.getElementById('select_multiple').options)
            {
                if(option.selected)
                {
                    select.push(option.value)
                }
            }
            $('#model_array').val(JSON.stringify(select));
            console.log(JSON.stringify(select))
        })

         let relation =  $('#relation').val(); 
        
         relation = JSON.parse(relation);
         let select_start = [];
        relation.forEach(models => 

           {
                for (var option of document.getElementById('select_multiple').options) {
                    if (option.value == models.id__fmm) 
                    {
                        option.defaultSelected = true;
                        select_start.push(option.value)
                        $('#model_array').val(JSON.stringify(select_start));
                    } 
                }
            }

        )

</script>
{% endblock %}