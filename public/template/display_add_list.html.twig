{% extends 'new_layout.twig' %}

{% block style %}
<link href="vendor/fontawesome/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="public/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="public/datatable/datatables.min.css">
<link rel="stylesheet" href="public/bootstrap/css/bootstrap-select.min.css">
<link rel="stylesheet" type="text/css" href="public/datatable/datatables.min.css">
<link rel="stylesheet" href="public/css/dashboard.css">
<link rel="stylesheet" href="public/css/forms-myrecode.css">
<link rel="stylesheet" href="public/css/cards-myrecode.css">
<link rel="stylesheet" href="public/css/font-family.css">
<style type="text/css">
    .past_purple {
        background-color: #A7BFE3;
        float: left;
        padding: 3px 5px 3px 5px;
        border-radius: 5px;
    }

    .past_pink {
        background-color: #F9D7E7;
        float: left;
        padding: 3px 5px 3px 5px;
        border-radius: 5px;
    }

    .past_greeen {
        background-color: #CBE5BE;
        float: left;
        padding: 3px 5px 3px 5px;
        border-radius: 5px;
    }
    .past_yellow {
        background-color: #FFF681;
        float: left;
        padding: 3px 5px 3px 5px;
        border-radius: 5px;
    }
    .past_blue {
        background-color: #90A4C3;
        float: left;
        padding: 3px 5px 3px 5px;
        border-radius: 5px;
    }
    .past_pastel {
        background-color: #FBDEDA;
        float: left;
        padding: 3px 5px 3px 5px;
        border-radius: 5px;
    }
    .past_orange {
        background-color: #F1CB9D;
        float: left;
        padding: 3px 5px 3px 5px;
        border-radius: 5px;
    }
    .past_red {
        background-color: #2D2B76;
        float: left;
        color: antiquewhite;
        padding: 3px 5px 3px 5px;
        border-radius: 5px;
    }
    .text-calm{
        font-family: 'Times New Roman', Times, serif !important;
        font-weight: 300 !important;
        box-shadow: none !important;
    }
    .link-reco{
        text-decoration: none;
        color: black;
    }
    #mbmax{
        margin-bottom: 150px !important;
    }
</style>
{% endblock %}
{% block main %}
<main role="main" class="container-fluid my-3 col-11 container-body" >
    <h3 class="recode-p"><i class="fad fa-building"></i></i> Administration Publicités MyRecode</h3>
    <div class="d-flex justify-content-start mt-4"  id="sticky-test">
        <div class="col-9 card-recode-admin ">
            <h4 class="recode-p"><i class="fas fa-users"></i> Liste</h4>
         
            <table id="table_id" class="display mt-3">
                <div class="my-2 float-right">
                    <button class="btn btn-recode-important" data-toggle="modal" data-target="#modalAjout">Ajouter</button>
                </div>
                <thead>
                    <tr >
                        <th>Titre</th>
                        <th>Lien</th>
                        <th>Texte</th>
                        <th>Client</th>
                        <th>Image</th>
                        
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for add in list %}
                       
                        <tr>
                            <td>
                                {{ add.ad__titre }}
                            </td>
                            <td>
                                {{ add.ad__lien }}
                            </td>
                            <td>
                                {{ add.ad__txt }}
                            </td>
                            <td>
                                
                            </td>
                            <td>

                            </td>
                            <td>

                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</main>

<div class="modal fade" id="modalAjout" tabindex="-1" role="dialog" aria-labelledby="modalmatosAjout"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            
            <div class="modal-header">
                <div>
                    <h5 class="modal-title">Ajouter une publicité</h5>
                  
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form action="" id="postAdd" method="post" enctype="multipart/form-data" >
                <div class="modal-body">
                    <div class="col-11 d-flex justify-content-start">
                        <div class="col-6">
                            <small class="form-text text-muted"> Titre</small>
                            <input class="form-control my-2 input-recode" name="add__titre" id="add__titre"  rows="2" ></input>
                        </div>
                        <div class="col-6">
                            <small class="form-text text-muted"> Lien</small>
                            <input class="form-control my-2 input-recode" name="add__lien" id="add__lien"  rows="2" ></input>
                        </div>
                    </div>
                    <div class="col-11 d-flex justify-content-start">
                        <div class="col-12">
                            <small class="form-text text-muted"> Texte</small>
                            <input class="form-control my-2 input-recode" name="add__txt" id="add__txt"  rows="2" ></input>
                        </div>
                        
                    </div>
                    <div class="col-11 d-flex justify-content-start">
                        <div class="col-12">
                            <small class="form-text text-muted"> Clients</small>
                            <select class="form-control my-2 form-control input-recode selectpicker text-calm text-muted" data-live-search="true" id="add__client">
                                {% for clientTT in list_client %}
                                
                                    <option value="{{clientTT.cli__id}}">{{ " ( " ~ clientTT.cli__id ~ " ) " ~ clientTT.cli__nom}}</option>
                            {% endfor %}
                            </select> 
                    </div>
                </div>
                    <div class="col-11 mb-3 d-flex justify-content-start">
                        <div class="col-12">
                            <small class="form-text text-muted"> Image</small>
                            <input class="form-control" name="add__img" type="file" id="add__img">
                    </div>
                   </div>
                
                <div class="modal-footer">
                    <button class="btn btn-recode-important"  id="postAjout" type="button">Ajouter</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript" src="public/datatable/datatables.min.js"></script>
<script type="text/javascript" src="public/bootstrap/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="public/bootstrap/js/bootstrap-select.min.js"></script>
<script type="text/javascript">
    $(document).ready(function(){

        var userTable =  $('#table_id').DataTable({
            paging: true,
            lengthMenu: [50],
            bLengthChange : false ,
            paging: true,             
            bPaginate: false,  
        
            language: {
                lengthMenu: "",
                zeroRecords: "Aucuns résultats",
                info: "",
                infoEmpty: "Aucuns résultats",
                infoFiltered: " ",
                search: "Rechercher"
            }
        });


        $('#postAjout').on('click',function(){
            
            let valid_titre = validateTitre();

            let valid_lien = validateLien();

            let valid_text = validateText();

            if(valid_text === 42 && valid_lien === 42 && valid_text === 42  ){
                
                let valid_image = validateImage();

                if(valid_image === 42 ){
                    alert('tu peux poster');
                }
            }

        })


        function validateTitre() {
            var input = document.getElementById("add__titre");
            var value = input.value.trim(); // Supprimer les espaces avant et après le texte
        
            if (value.length < 3) {
              // Le texte est trop court
              input.setCustomValidity("Le titre doit avoir au moins 3 caractères.");
            } else if (value.length > 35) {
              // Le texte est trop long
              input.setCustomValidity("Le titre ne peut pas dépasser 35 caractères.");
            } else {
                return 42 ;
            }
        }


        function validateLien() {
            var input = document.getElementById("add__lien");
            var value = input.value.trim(); // Supprimer les espaces avant et après le texte
        
            if (value.length < 10) {
              // Le texte est trop court
              input.setCustomValidity("Le lien doit avoir au moins 10 caractères.");
            } else if (value.length > 150) {
              // Le texte est trop long
              input.setCustomValidity("Le lien ne peut pas dépasser 70 caractères.");
            } else {
              // La longueur du texte est valide
              return 42 ;
            }
          }


          function validateText() {
            var input = document.getElementById("add__txt");
            var value = input.value.trim(); // Supprimer les espaces avant et après le texte
        
            if (value.length < 5) {
              // Le texte est trop court
              input.setCustomValidity("Le texte doit avoir au moins 5 caractères.");
            } else if (value.length > 250) {
              // Le texte est trop long
              input.setCustomValidity("Le texte ne peut pas dépasser 250 caractères.");
            } else {
              // La longueur du texte est valide
              return 42 ;
            }
          }


          function validateImage() {
            var input = document.getElementById("add__img");
            var file = input.files[0];
          
            // Vérifier si un fichier a été sélectionné
            if (file) {
              // Vérifier le type de fichier (PNG)
              if (file.type !== "image/png") {
                alert("Le fichier doit être au format PNG.");
                input.value = ""; // Effacer le champ de saisie
                return;
              }
              
              // Créer un objet Image
              var img = new Image();
              // Charger le fichier image en utilisant URL.createObjectURL AVANT le contrôle des dimensions
              img.src = URL.createObjectURL(file);
          
              img.onload = function() {
                if (img.width === 280 && img.height === 280) {
                  // L'image est de la bonne taille
                    return 42 ;
                } else {
                  alert("L'image doit faire exactement 280x280 pixels.");
                  input.value = ""; // Effacer le champ de saisie
                }
              };
            }
          }
    });
    </script>

{% endblock %}